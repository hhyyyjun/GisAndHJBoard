<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
                        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.lee.mapstudy.boardDao.BoardDao">
<!-- 글 작성 -->

<select id="checkSeq" resultType="String">
	SELECT TB_BOARD_SEQ.NEXTVAL FROM  DUAL
</select>


<insert id="insertBoard" parameterType="CustomMap">
	INSERT 
	 INTO 
	 TB_BOARD(
		 BNUM
		,BTITLE
		,BCONTENT
		,MID)
	 VALUES(
	 	 #{bnum}
	 	,#{btitle}
	 	,#{bcontent}
	 	,#{userId})
</insert>
<!-- 게시글 상세페이지, 수정페이지 -->
<select id="selectBoardInfo" parameterType="CustomMap" resultType="CustomMap">
	SELECT
		 B.BNUM 
		,B.BTITLE
		,B.BCONTENT
		,M.MID
		,M.MNICK
		,TO_CHAR(B.BDATE, 'YYYY-MM-DD') AS BDATE
	 FROM 
	 	 TB_BOARD B
	 	,TB_MEMBER M
	 WHERE 1 = 1
	 AND B.MID = M.MID
	 AND
	 	BNUM=#{bnum}
</select>
<!-- 게시판 목록 -->
 <select id="boardList" resultType="CustomMap" parameterType="CustomMap">
    <![CDATA[
     SELECT
          BNUM
		 ,BTITLE
	     ,BCONTENT
		 ,MNICK
		 ,BDATE
		 ,BCNT
	 FROM
	 	(
	 	SELECT
	 	     A.*
	 	     ,ROWNUM AS BCNT
	 	FROM
	 	  (
	 	   SELECT 
	 		  B.BNUM
			 ,B.BTITLE
	   		 ,B.BCONTENT
			 ,M.MNICK
			 ,TO_CHAR(B.BDATE, 'YYYY-MM-DD') AS BDATE
			 ,ROWNUM
			  FROM
			    TB_BOARD B
			   ,TB_MEMBER M
			   WHERE 1 = 1
	 	 	   AND B.MID = M.MID
			   ORDER BY BNUM DESC
			   ) A 
			   WHERE 1 = 1
			   AND ROWNUM <= #{page} * #{perPageNum}
			   )
	 	 		WHERE 1 = 1
	 	 		AND BCNT > (#{page}-1) * #{perPageNum}
	]]>
</select>
<select id="boardListCnt" resultType="int">
    SELECT 
     count(*)
      FROM 
       TB_BOARD
</select>



<!-- 게시글 삭제 -->
<delete id="deleteBoard" parameterType="CustomMap">
	DELETE 
	 FROM 
	 	TB_BOARD 
	 WHERE 1 = 1
	 AND 
	 	BNUM = #{bnum}
</delete>
<!-- 게시글 수정 -->
<update id="updateBoard" parameterType="CustomMap">
	UPDATE 
		TB_BOARD 
	 SET 
	 	 BTITLE=#{btitle}
	 	,BCONTENT=#{bcontent}
	 WHERE 1 = 1
	 AND BNUM = #{bnum}
</update>
</mapper>